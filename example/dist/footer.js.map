{
  "version": 3,
  "sources": ["../../eventtrap.ts", "../src/header.ts"],
  "sourcesContent": ["const JSACTION_ATTR = 'jsaction'\n\nexport interface EventInfo {\n    event: Event;\n    action: string;\n    actionElement: Element;\n}\n\nexport type EventHandler = (eventInfo: EventInfo) => void;\n\nexport class EventTrap {\n    private handler: EventHandler|null;\n    private queue: EventInfo[] = [];\n\n    constructor(private readonly container: Element, events: string[]) {\n        for (const event of events) {\n            this.installEventCapturer(event);\n        }\n    }\n\n    attachHandler(handler: EventHandler) {\n        if (this.handler) throw new Error('Handler already attached');\n        this.handler = handler;\n        for (const eventInfo of this.queue) {\n            this.handler(eventInfo);\n        }\n        this.queue = [];\n    }\n\n    private installEventCapturer(eventType: string) {\n        // TODO: handle the events that don't bubble\n        this.container.addEventListener(eventType, e => this.captureEvent(eventType, e));\n    }\n\n    private captureEvent(eventType: string, event: Event) {\n        const ancestors = event.composedPath();\n        for (const el of ancestors) {\n            if (!(el instanceof Element)) continue;\n            const actionMap = this.getActions(el);\n            const action = actionMap.get(eventType);\n            if (action) return this.handleEvent({event, action, actionElement: el});\n        }\n    }\n\n    private handleEvent(eventInfo: EventInfo) {\n        if (this.handler) this.handler(eventInfo);\n        else this.queue.push(eventInfo);\n    }\n\n    private getActions(el: Element): Map<string, string> {\n        // TODO: cache parsing\n        if (!el.hasAttribute(JSACTION_ATTR)) return new Map();\n\n        const attr = el.getAttribute(JSACTION_ATTR);\n        const bindings = attr.split(/\\s*;\\s*/);\n        const actionMap = new Map<string, string>();\n        for (const binding of bindings) {\n            const parts = binding.split(/\\s*:\\s*/);\n            if (parts.length !== 2) {\n                console.log(\n                    `Invalid jsaction syntax, expected one comma separator in ${binding}`);\n                continue;\n            }\n            const [eventType, action] = parts;\n            // TODO: warn about duplicate actions\n            actionMap.set(eventType, action);\n\n        }\n        return actionMap;\n    }\n}\n", "/* This file must be compiled into a separate bundle and inlined at the top of the page */\nimport {EventTrap} from '../../eventtrap';\n\n// TODO: have a more canonical list of events\nwindow['__eventTrap__'] = new EventTrap(document.documentElement, [\n    \"auxclick\",\n    \"blur\",\n    \"change\",\n    \"click\",\n    \"compositionend\",\n    \"compositionstart\",\n    \"compositionupdate\",\n    \"contextmenu\",\n    \"copy\",\n    \"cut\",\n    \"dblclick\",\n    \"dragend\",\n    \"dragenter\",\n    \"dragleave\",\n    \"dragover\",\n    \"dragstart\",\n    \"drop\",\n    \"error\",\n    \"focus\",\n    \"focusin\",\n    \"focusout\",\n    \"input\",\n    \"keydown\",\n    \"keypress\",\n    \"keyup\",\n    \"load\",\n    \"mousedown\",\n    \"mouseenter\",\n    \"mouseleave\",\n    \"mouseout\",\n    \"mouseover\",\n    \"mouseup\",\n    \"pagehide\",\n    \"pageshow\",\n    \"paste\",\n    \"pointerdown\",\n    \"pointerup\",\n    \"submit\",\n    \"touchend\",\n    \"touchmove\",\n    \"touchstart\",\n    \"visibilitychange\",\n    \"wheel\",\n]);\n"],
  "mappings": "MAAA,GAAM,GAAgB,WAUf,OAAgB,CAInB,YAA6B,EAAoB,EAAkB,CAAtC,iBAFrB,WAAqB,GAGzB,OAAW,KAAS,GAChB,KAAK,qBAAqB,GAIlC,cAAc,EAAuB,CACjC,GAAI,KAAK,QAAS,KAAM,IAAI,OAAM,4BAClC,KAAK,QAAU,EACf,OAAW,KAAa,MAAK,MACzB,KAAK,QAAQ,GAEjB,KAAK,MAAQ,GAGT,qBAAqB,EAAmB,CAE5C,KAAK,UAAU,iBAAiB,EAAW,GAAK,KAAK,aAAa,EAAW,IAGzE,aAAa,EAAmB,EAAc,CAClD,GAAM,GAAY,EAAM,eACxB,OAAW,KAAM,GAAW,CACxB,GAAI,CAAE,aAAc,UAAU,SAE9B,GAAM,GAAS,AADG,KAAK,WAAW,GACT,IAAI,GAC7B,GAAI,EAAQ,MAAO,MAAK,YAAY,CAAC,QAAO,SAAQ,cAAe,KAInE,YAAY,EAAsB,CACtC,AAAI,KAAK,QAAS,KAAK,QAAQ,GAC1B,KAAK,MAAM,KAAK,GAGjB,WAAW,EAAkC,CAEjD,GAAI,CAAC,EAAG,aAAa,GAAgB,MAAO,IAAI,KAGhD,GAAM,GAAW,AADJ,EAAG,aAAa,GACP,MAAM,WACtB,EAAY,GAAI,KACtB,OAAW,KAAW,GAAU,CAC5B,GAAM,GAAQ,EAAQ,MAAM,WAC5B,GAAI,EAAM,SAAW,EAAG,CACpB,QAAQ,IACJ,4DAA4D,KAChE,SAEJ,GAAM,CAAC,EAAW,GAAU,EAE5B,EAAU,IAAI,EAAW,GAG7B,MAAO,KChEf,OAAO,cAAmB,GAAI,GAAU,SAAS,gBAAiB,CAC9D,WACA,OACA,SACA,QACA,iBACA,mBACA,oBACA,cACA,OACA,MACA,WACA,UACA,YACA,YACA,WACA,YACA,OACA,QACA,QACA,UACA,WACA,QACA,UACA,WACA,QACA,OACA,YACA,aACA,aACA,WACA,YACA,UACA,WACA,WACA,QACA,cACA,YACA,SACA,WACA,YACA,aACA,mBACA",
  "names": []
}
